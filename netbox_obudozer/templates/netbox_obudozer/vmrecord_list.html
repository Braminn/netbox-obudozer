{% extends 'generic/object_list.html' %}

{% block title %}VM Records{% endblock %}

{% block extra_controls %}
    {{ block.super }}
    <a href="{% url 'plugins:netbox_obudozer:sync_vcenter' %}" class="btn btn-primary"
       onclick="return confirm('Вы уверены, что хотите запустить синхронизацию с vCenter?');">
        <i class="mdi mdi-sync"></i> Синхронизировать с vCenter
    </a>
{% endblock %}

{% block content %}
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">
                <i class="mdi mdi-information"></i> Статус синхронизации
            </h5>
            <div class="row">
                <div class="col-md-3">
                    <div class="small text-muted">Всего VM</div>
                    <div class="h4">{{ sync_status.total_vms }}</div>
                </div>
                <div class="col-md-3">
                    <div class="small text-muted">Существующих</div>
                    <div class="h4 text-success">{{ sync_status.existing_vms }}</div>
                </div>
                <div class="col-md-3">
                    <div class="small text-muted">Отсутствующих</div>
                    <div class="h4 text-warning">{{ sync_status.missing_vms }}</div>
                </div>
                <div class="col-md-3">
                    <div class="small text-muted">vCenter</div>
                    <div class="h4">
                        {% if sync_status.vcenter_available %}
                            <span class="badge bg-success"><i class="mdi mdi-check"></i> Доступен</span>
                        {% else %}
                            <span class="badge bg-danger"><i class="mdi mdi-close"></i> Недоступен</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% if sync_status.last_sync %}
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="mdi mdi-clock-outline"></i>
                        Последняя синхронизация: {{ sync_status.last_sync|date:"d.m.Y H:i:s" }}
                    </small>
                </div>
            {% else %}
                <div class="mt-2">
                    <small class="text-muted">
                        <i class="mdi mdi-alert"></i>
                        Синхронизация еще не выполнялась
                    </small>
                </div>
            {% endif %}
        </div>
    </div>
    {{ block.super }}
{% endblock %}
